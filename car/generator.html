<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES Encryption/Decryption using 5-Digit PIN</title>
</head>
<body>
    18791818791818791818791818791818

    <h2>AES Encryption/Decryption using 5-Digit PIN</h2>

    <label for="pin">Enter 5-Digit PIN:</label>
    <input type="text" id="pin" maxlength="5" placeholder="Enter 5-Digit PIN (e.g. 18791)" required>

    <label for="plaintext">Enter Text to Encrypt:</label>
    <textarea id="plaintext" rows="4" cols="50" placeholder="Enter text here..."></textarea>

    <button onclick="encryptData()">Encrypt</button>

    <h3>Encrypted Data:</h3>
    <textarea id="encryptedData" rows="4" cols="50" readonly></textarea>

    <button onclick="decryptData()">Decrypt</button>

    <h3>Decrypted Data:</h3>
    <textarea id="decryptedData" rows="4" cols="50" readonly></textarea>

    <script>
        async function deriveKeyFromPIN(pin) {
            // Ensure the pin is exactly 5 digits long
            if (pin.length !== 5) {
                alert("PIN must be exactly 5 digits long.");
                throw new Error("Invalid PIN length");
            }
    
            // Derive the key by repeating the PIN to 32 characters
            const keyMaterial = new TextEncoder().encode(pin.repeat(Math.ceil(32 / pin.length)).slice(0, 32));
    
            // Import the key material to create a CryptoKey object
            return await crypto.subtle.importKey(
                "raw",
                keyMaterial,
                { name: "AES-CBC", length: 256 },
                false,
                ["encrypt", "decrypt"]
            );
        }
    
        function deriveIVFromPIN(pin) {
            // Derive the IV by repeating the PIN to 16 characters
            const iv = new TextEncoder().encode(pin.repeat(Math.ceil(16 / pin.length)).slice(0, 16));
            return iv;
        }
    
        async function encryptData() {
            const pin = document.getElementById("pin").value;
            const plaintext = document.getElementById("plaintext").value;
    
            if (!pin || !plaintext) {
                alert("Please enter both a 5-digit PIN and text to encrypt.");
                return;
            }
    
            const key = await deriveKeyFromPIN(pin);
            const iv = deriveIVFromPIN(pin);
            const data = new TextEncoder().encode(plaintext);
    
            const encrypted = await crypto.subtle.encrypt(
                { name: "AES-CBC", iv: iv },
                key,
                data
            );
    
            // Convert encrypted data to Base64 for display
            const encryptedData = btoa(String.fromCharCode(...new Uint8Array(encrypted)));
            document.getElementById("encryptedData").value = encryptedData;
        }
    
        async function decryptData() {
            const pin = document.getElementById("pin").value;
            const encryptedData = document.getElementById("encryptedData").value;
    
            if (!pin || !encryptedData) {
                alert("Please enter both a 5-digit PIN and encrypted data.");
                return;
            }
    
            const key = await deriveKeyFromPIN(pin);
            const iv = deriveIVFromPIN(pin);
    
            // Convert Base64 encrypted data back to Uint8Array
            const encryptedBytes = Uint8Array.from(atob(encryptedData), c => c.charCodeAt(0));
    
            try {
                const decrypted = await crypto.subtle.decrypt(
                    { name: "AES-CBC", iv: iv },
                    key,
                    encryptedBytes
                );
    
                const decryptedText = new TextDecoder().decode(decrypted);
                document.getElementById("decryptedData").value = decryptedText;
            } catch (error) {
                alert("Decryption failed. Please make sure the PIN is correct and try again.");
            }
        }
    </script>
    
</body>
</html>
